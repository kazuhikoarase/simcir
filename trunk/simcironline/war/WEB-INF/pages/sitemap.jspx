<?xml version="1.0" encoding="UTF-8" ?>
<jsp:root xmlns:jsp="http://java.sun.com/JSP/Page" version="2.0"
		xmlns:c="http://java.sun.com/jsp/jstl/core"
		xmlns:s="urn:jsptagdir:/WEB-INF/tags/s">
		

	<jsp:directive.page contentType="application/xml;charset=UTF-8" />

	<jsp:directive.page import="java.util.Date"/>
	<jsp:directive.page import="java.util.TimeZone"/>
	<jsp:directive.page import="java.text.SimpleDateFormat"/>
	<jsp:directive.page import="com.d_project.simcir.datastore.CircuitList"/>
	<jsp:directive.page import="com.d_project.simcir.datastore.SimcirstoreServiceFactory"/>
	<jsp:directive.page import="com.d_project.simcir.datastore.SimcirstoreService"/>

	<jsp:scriptlet><![CDATA[

SimcirstoreService ss = SimcirstoreServiceFactory.getSimcirstoreService();
CircuitList circuitList = ss.getRecentCircuitList(0);
SimpleDateFormat formatter = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss'+00:00'");
formatter.setTimeZone(TimeZone.getTimeZone("UTC") );
Date lastMod = circuitList.getList().size() > 0?
		circuitList.getList().get(0).getUpdateDate() : new Date();
pageContext.setAttribute("lastMod", formatter.format(lastMod) );
pageContext.setAttribute("circuitList", circuitList);

]]></jsp:scriptlet>
	
	<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9"
			xmlns:image="http://www.google.com/schemas/sitemap-image/1.1">
		<url>
			<loc><s:baseURL/>/</loc>
			<lastmod>${lastMod}</lastmod>
			<changefreq>daily</changefreq>
			<priority>0.8</priority>
		</url>
		<c:forEach var="circuit" items="${circuitList.list}">
			<url>			
				<loc><s:baseURL/>/circuit?key=${circuit.key}</loc>
				<image:image>
					<image:loc><s:baseURL/>/circuit?fmt=img&amp;amp;key=${circuit.key}</image:loc>
					<image:title><c:out value="${circuit.title}"/></image:title>
				</image:image>
			</url> 
		</c:forEach>
	</urlset>

</jsp:root>
	